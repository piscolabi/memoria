{{ define "main" }}
  <div class='hx-mx-auto hx-max-w-screen-xl hx-relative'>
    <!-- Sidebar con posición absoluta para que non afecte ao layout -->
    <div class="sidebar-wrapper hx-absolute hx-left-0 hx-top-0 md:hx-hidden">
      {{ partial "sidebar.html" (dict "context" .) }}
    </div>
    
    <article class="hx-w-full hx-break-words hx-flex hx-min-h-[calc(100vh-var(--navbar-height))] hx-min-w-0 hx-justify-center hx-pb-8 hx-pr-[calc(env(safe-area-inset-right)-1rem)]">
      <main class="hx-w-full hx-min-w-0 hx-max-w-4xl hx-px-6 hx-pt-4 hx-md:px-12 hx-mx-auto">
        {{ partial "breadcrumb.html" . }}
        <h1 class="hx-mt-2 hx-text-4xl hx-font-bold hx-tracking-tight hx-text-slate-900 dark:hx-text-slate-100 hx-text-center">{{ .Title }}</h1>
        
        <div class="content hx-text-left">
          {{ .Content }}
        </div>
        {{ partial "components/last-updated.html" . }}
        {{ partial "components/pager.html" . }}
        {{ partial "components/comments.html" . }}
        
        <!-- TOC para pantallas pequenas e medianas (oculto en pantallas grandes) -->
        <div class="normal-toc xxl:hx-hidden hx-mt-6">
          <div class="hextra-toc-override">
            {{ partial "toc.html" . }}
          </div>
        </div>
      </main>
    </article>
    
    <!-- TOC para pantallas grandes (oculto en pantallas pequenas e medianas) -->
    <div class="desktop-toc hx-hidden xxl:hx-block">
      {{ partial "toc.html" . }}
    </div>
  </div>
  
  <style>
    /* En pantallas pequenas, permítese que o sidebar funcione normalmente */
    @media (max-width: 767px) {
      .sidebar-wrapper {
        position: static !important; /* Anula a posición absoluta */
        visibility: visible;
        pointer-events: auto;
      }
    }
    
    /* Definimos a media query para pantallas extra grandes */
    @media (min-width: 1800px) {
      :root {
        --xxl-screen: 1800px;
      }
      
      .xxl\:hx-hidden {
        display: none !important;
      }
      
      .xxl\:hx-block {
        display: block !important;
      }
      
      /* Mantememos os estilos orixinais do TOC, pero posicionámolo fixo á dereita */
      .desktop-toc {
        position: fixed;
        top: calc(var(--navbar-height) + 2rem);
        right: 2rem;
        width: 16rem;
        max-height: calc(100vh - var(--navbar-height) - 4rem);
        overflow-y: auto;
      }
    }
    
    /* Anulamos os estilos que poderían estar ocultando o TOC normal */
    .normal-toc .hextra-toc-override nav.hextra-toc {
      display: block !important;
      position: static !important;
      width: 100% !important;
      order: initial !important;
    }
    
    /* Aseguramos que o contido do TOC normal sexa visible */
    .normal-toc .hextra-toc-override .hextra-scrollbar {
      position: static !important;
      max-height: none !important;
      display: block !important;
    }
    
    /* Corriximos calquera clase que poida estar ocultando o TOC en certos tamaños de pantalla */
    @media (max-width: 1279px) {
      .normal-toc .hextra-toc-override nav.hextra-toc {
        display: block !important;
      }
    }
  </style>
  
  <script>
    // Asegúrase de que o script de "Volver ao topo" funcione
    document.addEventListener('DOMContentLoaded', function() {
      // Función para facer scroll ata arriba
      window.scrollUp = function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      };
      
      // Mostrar/ocultar o botón "Volver ao topo" baseado na posición de scroll
      window.addEventListener('scroll', function() {
        const backToTopButtons = document.querySelectorAll('#backToTop');
        backToTopButtons.forEach(button => {
          if (window.scrollY > 300) {
            button.classList.remove('hx-opacity-0');
            button.classList.add('hx-opacity-100');
          } else {
            button.classList.remove('hx-opacity-100');
            button.classList.add('hx-opacity-0');
          }
        });
      });
    });
  </script>
{{ end }}